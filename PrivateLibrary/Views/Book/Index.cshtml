@using PrivateLibrary.Data.Models;
@model ICollection<Book>

<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">

<form asp-controller="Book" asp-action="Index" method="get">
    <p>
        <input type="search" id="searchBox" name="search" value="@ViewBag.Search" placeholder="Заглавие, автор, ISBN" />
        <input type="submit" value="Търси" />
    </p>
</form>

@if (User.IsInRole("Admin"))
{
    <div>
        <a asp-controller="Book" asp-action="Add" class="btn btn-success "> <i class="bi bi-person-dash-fill"></i>Add</a>
    </div>
}

@foreach (var book in Model)
{
    <div class="card" style=" padding: 25px 25px 25px 25px;">
        <div class="container" style">
            <div class="row">
                <div class="col-12 d-flex justify-content-center">
                    <h4>
                        <b>
                            <text>@book.Title</text>
                        </b>
                    </h4>
                </div>
            </div>

            <p>
                <img src="@book.Image" />
            </p>

            <p>
                Author: @book.Author

            </p>

            <p>
                IsTaken: @book.IsTaken

            </p>

            <p>
                Cost: @book.CostPerDay

            </p>

            <a asp-controller="Book" asp-action="Details" asp-route-id="@book.Id" class="btn btn-danger "> <i class="bi bi-person-dash-fill"></i>Details</a>
        </div>
    </div>
}

<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script>
    $("#searchBox").autocomplete({
        source: function (request, response) {
            $.ajax({
                type: "GET",
                url: "Book/AutoComplete",
                data: { search: request.term },
                dataType: "json",
                success: function (data) {
                    response($.map(data, function (item) {
                        return {
                            label: item.title + ", " + item.author, // Display both title and author
                            value: item.title // Set the value to the book title (optional)
                        };
                    }));
                },
                error: function (response) {
                    console.log(response.responseText);
                }
            });
        },
        minLength: 1 // Minimum number of characters before autocomplete starts
    });
</script>
